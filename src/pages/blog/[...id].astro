---
import Base from '../../layouts/Base.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { id: post.id },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await render(post);
const readingTime = Math.ceil(post.body.split(/\s+/).length / 200);
---

<Base title={post.data.title} description={post.data.description}>
  <div class="progress-bar" id="progress" style="width: 0%"></div>
  
  <article class="py-12 reveal">
    <header class="mb-12">
      <a href="/" class="inline-flex items-center gap-2 text-[var(--ocean-500)] hover:text-[var(--ocean-400)] text-sm transition-colors mb-8 group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="group-hover:-translate-x-1 transition-transform">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        back to posts
      </a>
      <h1 class="text-3xl md:text-4xl font-light text-[var(--ocean-100)] mb-4 leading-tight tracking-tight">{post.data.title}</h1>
      <div class="flex gap-4 text-sm text-gray-500">
        <time>{post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
        <span class="text-[var(--ocean-700)]">Â·</span>
        <span>{readingTime} min read</span>
      </div>
    </header>

    <div class="prose text-lg">
      <Content />
    </div>

    <footer class="mt-16 pt-8 border-t border-[var(--ocean-800)]">
      <a href="/" class="inline-flex items-center gap-2 text-[var(--ocean-500)] hover:text-[var(--ocean-400)] text-sm transition-colors group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="group-hover:-translate-x-1 transition-transform">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        back to posts
      </a>
    </footer>
  </article>

  <script>
    function initProgress() {
      const bar = document.getElementById('progress');
      if (!bar) return;
      
      function updateProgress() {
        const scrollTop = window.scrollY;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = progress + '%';
      }

      window.addEventListener('scroll', updateProgress, { passive: true });
      updateProgress();
    }

    initProgress();
    document.addEventListener('astro:after-swap', initProgress);
  </script>
</Base>
